# Простые движения

В данном примере рассмотрены особенности простых движений при работе с промышленными роботами KUKA.

## Модули

### Структура модуля
Модули, создаваемые на роботах KUKA состоят из двух файлов:
1. Файл с расширением *.scr* - это главный исполняемый файл, внутри которого используются готовые выражения, называемые формулярами и отдельные выражения, которые прописывыет.

    В примере представлены примеры программы, которые были скопированы с робота через программное обеспечение Work Visual.

    Формуляры движений в стандартном виде, которые вы можете увидеть через пульт управления Smart Pad:

    ![Пример формуляра](../../media/photos/formular.png "Пример формуляра для движения типа PTP")

    Но в примерах вы можете увидеть полностью закрытую версию формуляра от пользователя часть, которая начинается с **;FOLD** и заканчивается **;ENDFOLD**:

    ```
    ;FOLD SPTP P1 Vel=10 % PDAT1 Tool[1]:Freza Base[0] ;%{PE}
    ;FOLD Parameters ;%{h}
    ;Params IlfProvider=kukaroboter.basistech.inlineforms.movement.spline; Kuka.IsGlobalPoint=False; Kuka.PointName=P1; Kuka.BlendingEnabled=False; Kuka.MoveDataPtpName=PDAT1; Kuka.VelocityPtp=10; Kuka.VelocityFieldEnabled=True; Kuka.ColDetectFieldEnabled=True; Kuka.CurrentCDSetIndex=0; Kuka.MovementParameterFieldEnabled=True; IlfCommand=SPTP
    ;ENDFOLD
    SPTP XP1 WITH $VEL_AXIS[1] = SVEL_JOINT(10.0), $TOOL = STOOL2(FP1), $BASE = SBASE(FP1.BASE_NO), $IPO_MODE = SIPO_MODE(FP1.IPO_FRAME), $LOAD = SLOAD(FP1.TOOL_NO), $ACC_AXIS[1] = SACC_JOINT(PPDAT1), $APO = SAPO_PTP(PPDAT1), $GEAR_JERK[1] = SGEAR_JERK(PPDAT1), $COLLMON_TOL_PRO[1] = USE_CM_PRO_VALUES(0)
    ;ENDFOLD
    ```

    В данном случае нас интересует только начальная строчка, которая соответствует нашему формуляру:

    ```;FOLD SPTP P1 Vel=10 % PDAT1 Tool[1]:Freza Base[0] ;%{PE}```

2. Файл с расширением *.dat* - это файл, в котором записываются основные значения координат и прочих значений, получаемых из *.src* файла.

<hr>

### Структура исполняемого файла

В исполняемом файле после создания файла имеется базовый набор формуляров и ключевых слов.

Начало программы обозначается:

```DEF название_модуля()```

Далее следует формуляр **INI**, который отвечает за подключение глобальных зависимостей, установленных на текущем роботе в исполняемый файл.

После этого следуют два формуляра с домашними позициями.

Конец программы завершается ключевым словом **END**, которое обозначает границы главной функции модуля - конец модуля.

<hr>

### Инициализация пользовательских переменных

Инициализация пользовательских переменных осуществляется между строчками названия модуля и **INI**:

```
DEF basic_moves()
decl pos xtriangle,xpreC,xresC
decl real dtriZ,dtriY,radius
decl bool fTriangle_local,fCircle_local,start_point
INI
```

В данном случае инициализировано три переменных структуры **pos**, которая описывает значения координаты и по три переменных типа **real** и **bool**.

При разработке программ для промышленных роботов KUKA используется проприетарный язык программировани **KRL** (*KUKA Robot Language*). Язык **KRL** - <u>нерегистрозависимый</u>. 

В языке **KRL**  присутствует 4 основных типа данных:

| Тип | Назначение | Значения |
|:-|:-:|:-:|
| **bool** | Булев тип данных. | true, false |
|**int** | Целые числа. | 1, 2, 3 и т.д.|
| **real** | Числа с плаввающей точкой. Целая и дробная части разделяются точкой. | 3.14 и т.д. |
| **char**| Символьный тип. Значения символов устанавливаются в одинарных кавычках. В двойных кавычках указывается массив символов CHAR_ARRAY. | 'a', '!' и т.д. |



### Переменные координат вложенной структуры **pos**

Для обозначения координат используются структуры как составной тип данных. Структуры на языке **KRL** схожи со структурами в **C**.

Структуры являются некоторой переменной, которая может описывать несколько различных значений.

Координаты точки в пространстве, с которой может взаимодействовать робот, описываются с помощью структуры **pos**. Каждая коодината имеет несколько значений, например, значения координат *x*,*y*,*z* или значения углов ориентации *A*,*B*,*C*. Для обращения к переменным точек, объявленных в формулярах, к названию переменной точки следует добавлять префикс *x*, например, для имени точки *P1* следует при использовании с помощью инструментов **KRL** следует написать *xP1*. Ниже представлен пример по работе с переменными точки: 

```
;через точку с запятой помечаются комментарии
decl pos xmypos ;декларирование точки

INI

;предположим что здесь объявлен формуляр для точки с именем P1

xmypos = xp1 ;копирование значений из точки p1 в нашу пользовательскую переменную
xmypos.x = xmypos.x + 100 ;изменения значения координаты x на 100 миллиметров в положительном направлении системы координат точки
```

Сокращённая форма присвоения значения на языке **KRL** <u>отсутствует</u>.

### Виды перемещений

Таблица видов перемещений роботов в пространстве:
| Вид | Принцип работы |
|:-|:-:|
|**ptp**|Движение от точки к точке, при котором робот выполняет перемещение по наиболее оптимальной для него траектории.|
|**lin**|Движение от точки к точке по прямой.|
|**circ**|Движение по окружности - движение от начальной точки в к целевой точке перемещения через промежуточную. Начальная и конечная позиции не могут совпадать.|

Движения обозначаемые префиксом s, такие как **sptp**, **slin**, **scirc**, относятся к категории *Slpine* (движения со скруглениями). Без установки дополнительного параметра скругления будут работать аналогично стандартным видам, приведённым в таблице выше.

Движения можно выполнять бех формуляров используя следующий синтаксис:
```
$vel.cp = 0.3 ;установка значения скорости
slin xp1 ;выполнения перемещения по прямой в точку P1
```

### Условный оператор

Оператор ветвления на **KRL** имеет следующий синтаксис:

```
if условие then ;объявление условного оператора

тело с кодом, выполняемым, если условие принимает истинное значение

endif ;обозначение конца тела условного оператора
```

Функциональность оператора ветвления можно расширить, добавив в его конструкцию условие **else**, для обработки остальных случаев: 

```
if условие then 

тело с кодом, выполняемым, если условие принимает истинное значение

else

тело с кодом для обработки случаев, в которых условие принимает неистинное значение

endif 
```

На данный момент множественное ветвление в **KRL** не реализовано.